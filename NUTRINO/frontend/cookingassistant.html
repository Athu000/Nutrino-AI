<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cooking Assistant | Nutrino AI</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f4f4f9;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        h2 {
            color: #333;
            margin-bottom: 15px;
        }
        .step-display {
            font-size: 18px;
            font-weight: bold;
            margin: 20px 0;
            color: #555;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f8f8;
            padding: 10px;
            border-radius: 8px;
        }
        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        button {
            background: #28a745;
            color: white;
            font-size: 16px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #218838;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
    </style>
   <script>
    document.addEventListener("DOMContentLoaded", function () {
        const stepDisplay = document.querySelector(".step-display");
        const startBtn = document.getElementById("startCooking");
        const nextBtn = document.getElementById("nextStep");
        const voiceBtn = document.getElementById("voiceAssist");

        // ‚úÖ Retrieve the latest recipe from sessionStorage
        let storedRecipe = JSON.parse(sessionStorage.getItem("latestRecipe"));
        if (!storedRecipe || !storedRecipe.recipeText) {
            stepDisplay.innerHTML = "‚ö†Ô∏è No recipe found. Please generate one.";
            return;
        }

        let recipeText = storedRecipe.recipeText;
        console.log("‚úÖ Loaded Recipe Text:", recipeText);

        // ‚úÖ Extract sections from the recipe
        function extractSection(section) {
            let regex = new RegExp(`-\\s*\\*{2}\\s*${section}\\s*\\*{2}\\s*:\\s*\\n?([\\s\\S]*?)(?=\\n-\\s*\\*{2}|$)`, "i");
            let match = recipeText.match(regex);
            return match ? match[1].trim().split("\n").map(line => line.trim()).filter(line => line !== "") : [];
        }

        // ‚úÖ Combine Ingredients into One Step
        let ingredients = extractSection("Ingredients List");
        let steps = extractSection("Step-by-Step Instructions");

        if (ingredients.length > 0) {
            steps.unshift(`üõí **Collect these ingredients:** ${ingredients.join(", ")}`);
        }

        console.log("‚úÖ Processed Steps:", steps);

        let stepIndex = 0;
        // ‚úÖ Function to clean text for speech (removes emojis & markdown)
        function cleanForSpeech(text) {
            return text.replace(/[\u{1F300}-\u{1F6FF}]/gu, '') // Remove emojis
                       .replace(/\*\*/g, '') // Remove markdown (**bold**)
                       .trim();
        }
        // ‚úÖ Function to speak text
            function speak(text) {
                const speech = new SpeechSynthesisUtterance(cleanForSpeech(text)); // ‚úÖ Apply cleaning function
                speech.lang = "en-US";
                speech.volume = 1;
                speech.rate = 1;
                speech.pitch = 1.2;
                const voices = window.speechSynthesis.getVoices();
                const femaleVoice = voices.find(voice => voice.name.includes("Female") || voice.name.includes("Google UK English Female"));
            
                if (femaleVoice) {
                    speech.voice = femaleVoice;
                }
                window.speechSynthesis.speak(speech);
            }
        // ‚úÖ Function to show the next step
        function showStep() {
            if (stepIndex < steps.length) {
                stepDisplay.innerHTML = steps[stepIndex];
                stepIndex++;
                voiceBtn.disabled = false;
            } else {
                stepDisplay.innerHTML = "üéâ Cooking Complete! Enjoy your meal!";
                nextBtn.disabled = true;
                voiceBtn.disabled = true;
            }
        }

        // ‚úÖ Start Cooking
        startBtn.addEventListener("click", function () {
            if (steps.length === 0) {
                stepDisplay.innerHTML = "‚ö†Ô∏è No instructions available.";
                return;
            }
            stepIndex = 0;
            showStep();
            nextBtn.disabled = false;
            voiceBtn.disabled = false;
        });

        // ‚úÖ Next Step Button
        nextBtn.addEventListener("click", function () {
            showStep();
        });

        // ‚úÖ Voice Assist Button
        voiceBtn.addEventListener("click", function () {
            speak(stepDisplay.innerText);
            speak(cleanForSpeech(stepDisplay.innerText)); 
        });
        goBackBtn.addEventListener("click", function () {
        window.location.href = "index.html"; // ‚úÖ Go back to index page
        });
    });
</script>
</head>
<body>
    <div class="container">
        <h2>üç≥ Cooking Assistant</h2>
        <p>Follow step-by-step instructions to cook your meal!</p>
        
        <!-- Step Display -->
        <div class="step-display">Click "Start Cooking" to begin.</div>
        
        <!-- Buttons -->
        <div class="button-group">
            <button id="startCooking">Start Cooking</button>
            <button id="nextStep" disabled>Next Step</button>
            <button id="voiceAssist" disabled>üîä Voice Assist</button>
        </div>
        <!-- ‚úÖ Go Back Button -->
        <button id="goBackBtn" class="back-button">‚¨ÖÔ∏è Go Back</button>
    </div>
</body>
</html>
